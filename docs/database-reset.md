# 数据库重建与清理指南（MySQL + Docker）

本项目使用 Docker 启动 MySQL，数据通过 Docker Volume 持久化。

当需要**清空数据库并重新执行 Flyway 迁移**时，可按以下方式操作。

------------------------------------------------------------------------

## 一、方式一：删除数据库并重新创建（推荐）

适用于： - 想保留容器和数据卷 - 仅重建某个数据库

### 进入 MySQL 容器

``` bash
docker exec -it pet-mysql mysql -uroot -proot123
```

### 删除并重建数据库

``` sql
DROP DATABASE pet_demo;

CREATE DATABASE pet_demo
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;
```

退出：

``` sql
exit
```

然后重新启动应用，Flyway 会重新执行迁移。

------------------------------------------------------------------------

## 二、方式二：彻底清空数据库（删除数据卷）

适用于： - 想完全从零开始 - 删除所有数据库数据

进入 deploy 目录：

``` bash
cd deploy
```

执行：

``` bash
docker compose down -v
docker compose up -d
```

说明：

-   `down -v` 会删除数据卷
-   MySQL 会重新初始化
-   Flyway 会重新创建表结构

⚠️ 此操作会删除所有数据库数据。

------------------------------------------------------------------------

## 三、常用检查命令

查看运行容器：

``` bash
docker ps
```

查看数据卷：

``` bash
docker volume ls
```

------------------------------------------------------------------------

## 四、建议操作流程（开发阶段）

当数据库结构变化时：

1.  删除数据库
2.  重新创建数据库
3.  启动应用
4.  Flyway 自动执行迁移

------------------------------------------------------------------------

## 五、注意事项

-   不要频繁删除 volume，除非确认数据可丢弃
-   重要数据应先做 mysqldump 备份
